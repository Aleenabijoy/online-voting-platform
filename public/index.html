<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login | Online Voting</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #fde2e4, #e0f2fe);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .card {
      background: white;
      padding: 40px;
      border-radius: 20px;
      width: 380px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.12);
      text-align: center;
    }
    h2 { margin-top: 0; color: #334155; font-size: 22px; }
    input {
      width: 100%;
      padding: 11px 14px;
      margin: 7px 0;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      font-size: 14px;
    }
    input:focus { outline: none; border-color: #93c5fd; box-shadow: 0 0 0 3px rgba(147,197,253,0.3); }
    button {
      width: 100%;
      padding: 11px;
      margin-top: 10px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    button:hover { opacity: 0.88; }
    button:disabled { opacity: 0.55; cursor: not-allowed; }
    .btn-login  { background: linear-gradient(135deg, #a5b4fc, #93c5fd); color: #1e293b; }
    .btn-signup { background: #e2e8f0; color: #334155; }
    .btn-google { background: white; border: 1px solid #cbd5e1; color: #334155; display:flex; align-items:center; justify-content:center; gap:8px; }
    .btn-linkedin { background: #0a66c2; color: white; }
    hr { margin: 22px 0; border: none; height: 1px; background: #e2e8f0; }
    .forgot-link { font-size: 13px; color: #6366f1; text-decoration: none; display: inline-block; margin-top: 8px; }
    .forgot-link:hover { text-decoration: underline; }
    #msg {
      margin-top: 14px;
      font-size: 13px;
      padding: 10px 14px;
      border-radius: 8px;
      display: none;
    }
    .msg-error   { background: #fee2e2; color: #991b1b; }
    .msg-success { background: #d1fae5; color: #065f46; }
    .divider { font-size: 12px; color: #94a3b8; margin: 4px 0; }
  </style>
</head>
<body>
  <div class="card">
    <h2>üó≥Ô∏è Online Voting</h2>

    <input type="email"    id="email"    placeholder="Email address" />
    <input type="password" id="password" placeholder="Password" />

    <button class="btn-login"  onclick="doLogin()">Login</button>
    <button class="btn-signup" onclick="doSignup()">Sign Up</button>

    <a href="/forgot.html" class="forgot-link">Forgot password?</a>

    <hr>

    <button class="btn-google" onclick="location.href='/auth/google'">
      <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.1 0 5.9 1.1 8.1 2.9l6-6C34.4 3.3 29.5 1 24 1 14.9 1 7.2 6.5 3.9 14.3l7 5.4C12.5 13.3 17.8 9.5 24 9.5z"/><path fill="#4285F4" d="M46.5 24.5c0-1.6-.1-3.1-.4-4.5H24v8.5h12.7c-.6 3-2.3 5.5-4.9 7.2l7.6 5.9c4.4-4.1 7.1-10.1 7.1-17.1z"/><path fill="#FBBC05" d="M10.9 28.3A14.6 14.6 0 0 1 9.5 24c0-1.5.3-2.9.7-4.3l-7-5.4A23.9 23.9 0 0 0 0 24c0 3.9.9 7.5 2.6 10.7l8.3-6.4z"/><path fill="#34A853" d="M24 47c5.5 0 10.1-1.8 13.5-4.9l-7.6-5.9c-1.9 1.3-4.3 2-5.9 2-6.2 0-11.5-3.8-13.4-9.2l-8.3 6.4C7.2 41.5 14.9 47 24 47z"/></svg>
      Continue with Google
    </button>

    <button class="btn-linkedin" onclick="location.href='/auth/linkedin'">
      in &nbsp; Continue with LinkedIn
    </button>

    <div id="msg"></div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const msg = $("msg");

    function showMsg(text, isError) {
      msg.textContent = text;
      msg.className = isError ? "msg-error" : "msg-success";
      msg.style.display = "block";
    }

    async function doLogin() {
      const email = $("email").value.trim();
      const password = $("password").value;
      if (!email || !password) return showMsg("Please enter email and password.", true);

      try {
        const r = await fetch("/auth/local/login", {
          method: "POST",
          credentials: "include",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        const d = await r.json();
        // ‚úÖ FIX: Check success flag, not message string
        if (d.success) {
          window.location.href = d.profileCompleted ? "/vote-page" : "/profile.html";
        } else {
          showMsg(d.message || "Login failed.", true);
        }
      } catch { showMsg("Login failed. Check your connection.", true); }
    }

    async function doSignup() {
      const email = $("email").value.trim();
      const password = $("password").value;
      if (!email || !password) return showMsg("Please enter email and password.", true);
      if (password.length < 6) return showMsg("Password must be at least 6 characters.", true);

      try {
        const r = await fetch("/auth/local/signup", {
          method: "POST",
          credentials: "include",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        const d = await r.json();
        // ‚úÖ FIX: Check success flag, not message string
        if (d.success) {
          window.location.href = "/profile.html";
        } else {
          showMsg(d.message || "Signup failed.", true);
        }
      } catch { showMsg("Signup failed. Check your connection.", true); }
    }

    document.addEventListener("keydown", e => { if (e.key === "Enter") doLogin(); });
  </script>
</body>
</html>